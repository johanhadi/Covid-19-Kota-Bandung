---
title: "Statistik Covid-19 Kota Bandung (Update 06 Mei 2020)"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    source_code: embed
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(openxlsx)
library(leaflet)
library(shiny)
library(rgdal)
library(sp)
library(DT)
library(rpostgis)
library(htmltools)
library(rmarkdown)
library(knitr)
library(rpubs)
bandung<- readOGR("D:/Kerjaan/Covid19/@" ,"kasus bandung")
batas <- readOGR("D:/Kerjaan/LNA", "Kota Bandung")
tabel <- read.xlsx("D:/covid-19.xlsx", sheet = "Prov")
```

Row {data-height= 50}
-----------------------------------------------------------------------
### Total Kasus

```{r}
jumlahpositif <- 247
jumlahsembuh <- 30
jumlahmeninggal <- 34
jumlahtotal <- jumlahmeninggal +jumlahsembuh+jumlahpositif
valueBox(jumlahtotal, icon = "fa-hospital-user", color = "cyan")
```

### Positif

```{r}
valueBox(jumlahpositif, icon = "fa-plus", color = "orange")
```

### Sembuh

```{r}
valueBox(jumlahsembuh, icon = "fa-medkit", color = "green")
```

### Meninggal

```{r}
valueBox(jumlahmeninggal, 
         icon = "fa-ambulance", color = "red")
```

### Layanan Kedaruratan

```{r}
layanan <- "119 atau 112"
valueBox(layanan, 
         icon = "fa-phone", color = "blue")

```

### Persentase Kesembuhan {.bold}

```{r}
rate11 <- (jumlahsembuh/jumlahtotal)*100
rate1 <- round(rate11, digits = 2)
gauge(rate1, min = 0, max = 100, symbol = '%',  gaugeSectors(
  success = c(11, 100), warning = c(6, 10), danger = c(0, 5)
))
```

### Persentase Kematian

```{r}
rate22 <- (jumlahmeninggal/jumlahtotal)*100
rate2 <- round(rate22, digits = 2)
gauge(rate2, min = 0, max = 100, symbol = '%', gaugeSectors(
  success = c(0, 5), warning = c(6, 10 ), danger = c(11, 100)
))
```

Column {data-height=650}
---
### Peta Covid-19 Kota Bandung
```{r}
label1 <- sprintf(
  "<center><strong>%s<strong>%s</center>","Status : ",
  bandung$Status
) %>% lapply(htmltools::HTML)
label2 <- sprintf(
  "<strong>%s<strong>%s<br/><strong>%s<strong>%s<br/><strong>%s<strong>%s<br/><strong>%s<strong>%s<br/>","Kecamatan ",
  batas$WADMKC, "Positif    : ", batas$Positif, "Sembuh : ", batas$Sembuh,"Meninggal : ", batas$Meninggal
) %>% lapply(htmltools::HTML)
actpal <- colorFactor(c("red","orange","green"), bandung$Status)
leaflet(data = bandung) %>%
  addProviderTiles("Stamen.TonerLite", group="Toner Lite") %>%
  addProviderTiles("Stamen.Toner", group="Toner") %>%
  addPolygons(data = batas, fillColor = "transparent", weight = 2 , color = "black", dashArray = 3,
              highlightOptions = highlightOptions(weight = 10, color = "red", fillColor = "yellow"),
              label = label2,
              labelOptions = labelOptions(
                style = list("font-weight" = "normal", padding = "3px 8px"),
                textsize = "15px")) %>%
  addCircleMarkers(data = bandung, label = label1,
                   color = ~actpal(Status),clusterOptions = markerClusterOptions(),
                   labelOptions = labelOptions(color = "red"))%>%
  addLegend(position = "bottomright", pal = actpal, values = ~Status, title = "Keterangan", opacity = 0.6) %>%
  addLayersControl(
    baseGroups = c("Toner Lite", "Toner"),options = layersControlOptions()) %>%
  addMiniMap(
    tiles = providers$Stamen.TonerLite,
    toggleDisplay = TRUE, position = "bottomleft")%>%
  addEasyButton(easyButton(
    icon="fa-globe", title="Zoom Kota Bandung",
    onClick=JS("function(btn, map){ map.setZoom(12); }")))
```

### Tabel Covid-19 Kota Bandung
```{r}
datatable(tabel, options = list(
  bPaginate = FALSE
))
```